# Coverage Assessment Report
**Date:** 2026-01-03
**Subject:** Initial Code Coverage Analysis of `mdmp4rev`

## Executive Summary
The current code coverage is moderate, primarily covering validation logic and error states. Critical paths involving the actual execution of external commands (FFmpeg) and the main application entry point are completely uncovered. The integration test is currently ignored, leaving the "happy path" unverified in the automated test suite.

## Detailed Findings

### 1. Core Logic (`VideoReverser`)
*   **Covered:**
    *   `new()` instantiation.
    *   `generate_output_filename()` logic.
    *   Input validation: File existence check and extension verification.
    *   `check_ffmpeg()` failure path (simulated by clearing `PATH`).
*   **Uncovered:**
    *   `check_ffmpeg()` success path.
    *   `reverse_video()` success path (Command construction and execution).
    *   `reverse_video()` error handling for FFmpeg failure (non-zero exit code).

### 2. Entry Point (`main`)
*   **Status:** 0% Coverage.
*   **Issues:** The `main` function contains CLI argument parsing and error reporting logic that is entirely untested. It calls `std::process::exit`, making it hard to test without refactoring.

### 3. Tests
*   `test_successful_video_reverse` is marked `#[ignore]`. This prevents the primary functionality from being tested during standard runs.
*   Tests rely on `std::env::set_var("PATH", ...)` which is not thread-safe and can cause flaky tests in parallel execution environments, although acceptable for single-threaded test runs.

## Recommendations
1.  **Refactor `main`:** Extract logic into a `run(args: Vec<String>, writer: impl Write)` function to verify CLI argument handling and output without running the binary.
2.  **Abstract Command Execution:** Introduce a trait (e.g., `CommandExecutor`) to mock `std::process::Command`. This allows testing `reverse_video` logic (command arguments construction, error propagation) without requiring FFmpeg to be installed.
3.  **Enable Integration Tests:** Either un-ignore the integration test (if CI has FFmpeg) or replace it with a robust mocked test that verifies the *intent* of the command call.
4.  **Cover Error Paths:** Specifically test the case where FFmpeg returns a non-zero exit code.
